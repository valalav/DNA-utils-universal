# üìä –†–∞–±–æ—Ç–∞ —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö DNA-utils-universal

## üìã –û–±–∑–æ—Ä

DNA-utils-universal –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ Y-STR –º–∞—Ä–∫–µ—Ä–æ–≤ –∏ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, –∫–∞–∂–¥—ã–π —Å–æ —Å–≤–æ–∏–º–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

## üóÑÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### FTDNA (Family Tree DNA)
- **–§–æ—Ä–º–∞—Ç**: JSON —Å –≤–ª–æ–∂–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø—ã, –ø–∞–ª–∏–Ω–¥—Ä–æ–º–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
- **–†–∞–∑–º–µ—Ä**: ~50,000+ –∑–∞–ø–∏—Å–µ–π
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ

### YFull Tree
- **–§–æ—Ä–º–∞—Ç**: JSON —Å —Ñ–∏–ª–æ–≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∏–º –¥–µ—Ä–µ–≤–æ–º
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ù–∞—É—á–Ω–∞—è –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ SNP, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏
- **–†–∞–∑–º–µ—Ä**: ~20,000+ –∑–∞–ø–∏—Å–µ–π  
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –ï–∂–µ–º–µ—Å—è—á–Ω–æ

### YFITTER
- **–§–æ—Ä–º–∞—Ç**: CSV —Å –º–∞—Ä–∫–µ—Ä–Ω—ã–º–∏ –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ, –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã–µ –Ω–∞–±–æ—Ä—ã
- **–†–∞–∑–º–µ—Ä**: ~5,000+ –∑–∞–ø–∏—Å–µ–π
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –ü–æ –∑–∞–ø—Ä–æ—Å—É

### Custom Repositories (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ)
- **–§–æ—Ä–º–∞—Ç**: JSON/CSV —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ö–µ–º–µ
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã
- **–†–∞–∑–º–µ—Ä**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –†—É—á–Ω—ã–µ

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ö–µ–º–∞ –∑–∞–ø–∏—Å–∏

```json
{
  "name": "Unique_Sample_ID",
  "haplogroup": "R-M269", 
  "markers": {
    "DYS393": "13",
    "DYS390": "24",
    "DYS19": "14",
    "DYS391": "11",
    "DYS385": "11-14",  // –ü–∞–ª–∏–Ω–¥—Ä–æ–º–Ω—ã–π –º–∞—Ä–∫–µ—Ä
    "DYS426": "12",
    "DYS388": "12",
    "DYS439": "12",
    "DYS389I": "13",
    "DYS392": "13",
    "DYS389II": "29",
    "DYS458": "17",
    "DYS459": "9-10",   // –ü–∞–ª–∏–Ω–¥—Ä–æ–º–Ω—ã–π –º–∞—Ä–∫–µ—Ä
    "DYS455": "11",
    "DYS454": "11",
    "DYS447": "25",
    "DYS437": "15",
    "DYS448": "19"
  },
  "metadata": {
    "source": "FTDNA",
    "updated": "2024-01-15",
    "quality": "high",
    "region": "Europe"
  }
}
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|-----|----------|---------|
| `name` | string | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | "FTDNA_12345" |
| `haplogroup` | string | –ì–∞–ø–ª–æ–≥—Ä—É–ø–ø–∞ Y-—Ö—Ä–æ–º–æ—Å–æ–º—ã | "R-M269" |
| `markers` | object | Y-STR –º–∞—Ä–∫–µ—Ä—ã | `{"DYS393": "13"}` |

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------|-----|----------|----------------------|
| `metadata.source` | string | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö | "unknown" |
| `metadata.quality` | string | –ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö | "medium" |
| `metadata.region` | string | –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ä–µ–≥–∏–æ–Ω | null |
| `metadata.updated` | string | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞ |

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

### repositories.config.ts

```typescript
// str-matcher/src/config/repositories.config.ts
export interface Repository {
  name: string;
  description: string;
  url: string;
  type: 'json' | 'csv';
  enabled: boolean;
  priority: number;
  filters?: string[];
  transform?: (data: any) => any;
}

export const repositories: Repository[] = [
  {
    name: 'FTDNA',
    description: 'Family Tree DNA Y-STR Database',
    url: '/data/ftdna-ystr-haplotypes.json',
    type: 'json',
    enabled: true,
    priority: 1,
    filters: ['R-*', 'I-*', 'E-*'],  // –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø—ã
    transform: transformFTDNAData
  },
  {
    name: 'YFull',
    description: 'YFull Phylogenetic Tree',
    url: '/data/yfull-samples.json', 
    type: 'json',
    enabled: true,
    priority: 2,
    transform: transformYFullData
  },
  {
    name: 'Custom',
    description: 'User Uploaded Data',
    url: null,  // –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    type: 'csv',
    enabled: true,
    priority: 3
  }
];
```

### –§—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

```typescript
// –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è FTDNA –¥–∞–Ω–Ω—ã—Ö
function transformFTDNAData(rawData: any[]): ProcessedEntry[] {
  return rawData.map(entry => ({
    name: entry.kit_number || entry.id,
    haplogroup: normalizeHaplogroup(entry.haplogroup),
    markers: extractMarkers(entry.markers),
    metadata: {
      source: 'FTDNA',
      quality: entry.confidence || 'medium',
      region: entry.geographic_region,
      updated: entry.last_updated
    }
  }));
}

// –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è YFull –¥–∞–Ω–Ω—ã—Ö  
function transformYFullData(rawData: any[]): ProcessedEntry[] {
  return rawData.map(entry => ({
    name: entry.yfull_id,
    haplogroup: entry.terminal_snp,
    markers: parseYFullMarkers(entry.str_markers),
    metadata: {
      source: 'YFull',
      quality: 'high',
      region: inferRegionFromId(entry.yfull_id),
      updated: entry.sample_date
    }
  }));
}
```

## üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

```javascript
// str-matcher/src/services/data-loader.service.js
class DataLoaderService {
  async loadRepositories() {
    const results = [];
    
    for (const repo of repositories.filter(r => r.enabled)) {
      try {
        console.log(`üì• –ó–∞–≥—Ä—É–∑–∫–∞ ${repo.name}...`);
        
        const data = await this.loadRepository(repo);
        const processed = repo.transform ? repo.transform(data) : data;
        const validated = this.validateData(processed);
        
        results.push({
          name: repo.name,
          data: validated,
          loadTime: Date.now(),
          count: validated.length
        });
        
        console.log(`‚úÖ ${repo.name}: ${validated.length} –∑–∞–ø–∏—Å–µ–π`);
      } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${repo.name}:`, error);
        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
      }
    }
    
    return results;
  }
  
  async loadRepository(repo: Repository) {
    if (repo.type === 'json') {
      const response = await fetch(repo.url);
      return await response.json();
    } else if (repo.type === 'csv') {
      return await this.parseCSV(repo.url);
    }
  }
  
  validateData(data: any[]): ProcessedEntry[] {
    return data.filter(entry => {
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
      if (!entry.name || !entry.haplogroup || !entry.markers) {
        console.warn('‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–∞ –∑–∞–ø–∏—Å—å –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π:', entry);
        return false;
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –º–∞—Ä–∫–µ—Ä–æ–≤
      if (typeof entry.markers !== 'object') {
        console.warn('‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –º–∞—Ä–∫–µ—Ä–æ–≤:', entry.name);
        return false;
      }
      
      return true;
    });
  }
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏

```javascript
// –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
const loadingStrategies = {
  // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
  async retryWithBackoff(loadFunction, maxAttempts = 3) {
    for (let attempt = 1; attempt <= maxAttempts; attempt++) {
      try {
        return await loadFunction();
      } catch (error) {
        if (attempt === maxAttempts) throw error;
        
        const delay = Math.pow(2, attempt) * 1000; // 2s, 4s, 8s
        console.log(`üîÑ –ü–æ–ø—ã—Ç–∫–∞ ${attempt}/${maxAttempts} –Ω–µ—É–¥–∞—á–Ω–∞, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${delay}ms`);
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
  },
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫—ç—à–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ
  async loadWithFallback(repo) {
    try {
      return await this.loadRepository(repo);
    } catch (error) {
      console.warn(`‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ ${repo.name} –Ω–µ—É–¥–∞—á–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à`);
      return this.loadFromCache(repo.name);
    }
  }
};
```

## üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

#### CSV —Ñ–æ—Ä–º–∞—Ç
```csv
name,haplogroup,DYS393,DYS390,DYS19,DYS391,DYS385,DYS426,DYS388
Sample001,R-M269,13,24,14,11,11-14,12,12
Sample002,I-M253,13,23,17,10,11-13,12,14
Sample003,E-M215,13,21,13,10,11-14,11,12
```

#### JSON —Ñ–æ—Ä–º–∞—Ç
```json
[
  {
    "name": "Sample001",
    "haplogroup": "R-M269",
    "markers": {
      "DYS393": "13",
      "DYS390": "24",
      "DYS19": "14"
    }
  }
]
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

```javascript
// –í–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
class UserDataValidator {
  validateFile(file, format) {
    const errors = [];
    const warnings = [];
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
    if (file.size > 50 * 1024 * 1024) { // 50MB
      errors.push('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 50MB)');
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞
    if (format === 'csv' && !file.name.endsWith('.csv')) {
      warnings.push('–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .csv');
    }
    
    return { errors, warnings };
  }
  
  validateData(data) {
    const issues = [];
    const validEntries = [];
    
    data.forEach((entry, index) => {
      const entryIssues = this.validateEntry(entry, index);
      if (entryIssues.errors.length === 0) {
        validEntries.push(entry);
      }
      if (entryIssues.errors.length > 0 || entryIssues.warnings.length > 0) {
        issues.push({ index, ...entryIssues });
      }
    });
    
    return { validEntries, issues };
  }
  
  validateEntry(entry, index) {
    const errors = [];
    const warnings = [];
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
    if (!entry.name) errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ name');
    if (!entry.haplogroup) errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ haplogroup');
    if (!entry.markers || Object.keys(entry.markers).length === 0) {
      errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–∞—Ä–∫–µ—Ä—ã');
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø—ã
    if (entry.haplogroup && !this.isValidHaplogroup(entry.haplogroup)) {
      warnings.push(`–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø—ã: ${entry.haplogroup}`);
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∫–µ—Ä–æ–≤
    if (entry.markers) {
      Object.entries(entry.markers).forEach(([marker, value]) => {
        if (!this.isValidMarkerValue(marker, value)) {
          warnings.push(`–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ ${marker}: ${value}`);
        }
      });
    }
    
    return { errors, warnings };
  }
  
  isValidHaplogroup(haplogroup) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–µ
    return /^[A-Z]-[A-Z0-9]+/.test(haplogroup);
  }
  
  isValidMarkerValue(marker, value) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –º–∞—Ä–∫–µ—Ä–æ–≤
    if (typeof value !== 'string') return false;
    
    // –ü–∞–ª–∏–Ω–¥—Ä–æ–º–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–µ—Ñ–∏—Å
    const palindromic = ['DYS385', 'DYS459', 'CDYa', 'CDYb'];
    if (palindromic.includes(marker)) {
      return /^\d+(-\d+)*$/.test(value);
    }
    
    // –û–±—ã—á–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã - —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞
    return /^\d+$/.test(value);
  }
}
```

## üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º

```typescript
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
interface RepositoryFilters {
  haplogroups?: string[];      // –§–∏–ª—å—Ç—Ä –ø–æ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø–∞–º
  regions?: string[];          // –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º  
  quality?: string[];          // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –¥–∞–Ω–Ω—ã—Ö
  markers?: string[];          // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
  dateRange?: [Date, Date];    // –î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}

const repositoryFilters: Record<string, RepositoryFilters> = {
  'FTDNA': {
    haplogroups: ['R-*', 'I-*', 'E-*', 'J-*', 'G-*'],
    quality: ['high', 'medium'],
    markers: ['DYS393', 'DYS390', 'DYS19']  // –ú–∏–Ω–∏–º—É–º 3 –º–∞—Ä–∫–µ—Ä–∞
  },
  'YFull': {
    haplogroups: ['*'],        // –í—Å–µ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø—ã
    quality: ['high'],         // –¢–æ–ª—å–∫–æ –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
    regions: ['Europe', 'Asia', 'Americas']
  }
};
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã

```javascript
// –°–∏—Å—Ç–µ–º–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
class DataFilter {
  applyFilters(data, filters) {
    return data.filter(entry => {
      // –§–∏–ª—å—Ç—Ä –ø–æ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø–µ
      if (filters.haplogroup && !this.matchesHaplogroup(entry.haplogroup, filters.haplogroup)) {
        return false;
      }
      
      // –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–≥–∏–æ–Ω—É
      if (filters.region && entry.metadata?.region !== filters.region) {
        return false;
      }
      
      // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—á–µ—Å—Ç–≤—É
      if (filters.quality && entry.metadata?.quality !== filters.quality) {
        return false;
      }
      
      // –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–ª–∏—á–∏—é –º–∞—Ä–∫–µ—Ä–æ–≤
      if (filters.requiredMarkers) {
        const hasAllMarkers = filters.requiredMarkers.every(marker => 
          entry.markers.hasOwnProperty(marker)
        );
        if (!hasAllMarkers) return false;
      }
      
      return true;
    });
  }
  
  matchesHaplogroup(entryHaplogroup, filterPattern) {
    if (filterPattern === '*') return true;
    if (filterPattern.endsWith('*')) {
      const prefix = filterPattern.slice(0, -1);
      return entryHaplogroup.startsWith(prefix);
    }
    return entryHaplogroup === filterPattern;
  }
}
```

## üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```javascript
// –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
class DataCache {
  constructor() {
    this.memoryCache = new Map();
    this.diskCache = new DiskCache('./cache');
  }
  
  async getRepository(repoName) {
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º memory cache
    if (this.memoryCache.has(repoName)) {
      console.log(`üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ ${repoName} –∏–∑ –ø–∞–º—è—Ç–∏`);
      return this.memoryCache.get(repoName);
    }
    
    // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º disk cache
    const cached = await this.diskCache.get(repoName);
    if (cached && this.isValidCache(cached)) {
      console.log(`üíø –ó–∞–≥—Ä—É–∑–∫–∞ ${repoName} —Å –¥–∏—Å–∫–∞`);
      this.memoryCache.set(repoName, cached.data);
      return cached.data;
    }
    
    // 3. –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–Ω–æ–≤–æ
    console.log(`üåê –ó–∞–≥—Ä—É–∑–∫–∞ ${repoName} –∏–∑ —Å–µ—Ç–∏`);
    const data = await this.loadFromNetwork(repoName);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à–∏
    this.memoryCache.set(repoName, data);
    await this.diskCache.set(repoName, {
      data,
      timestamp: Date.now(),
      ttl: 24 * 60 * 60 * 1000 // 24 —á–∞—Å–∞
    });
    
    return data;
  }
  
  isValidCache(cached) {
    return Date.now() - cached.timestamp < cached.ttl;
  }
}
```

### Lazy Loading

```javascript
// –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
class LazyDataLoader {
  async loadRepositoryChunks(repoName, chunkSize = 1000) {
    const chunks = [];
    let offset = 0;
    
    while (true) {
      const chunk = await this.loadChunk(repoName, offset, chunkSize);
      if (chunk.length === 0) break;
      
      chunks.push(chunk);
      offset += chunkSize;
      
      // –î–∞–µ–º –±—Ä–∞—É–∑–µ—Ä—É –ø–µ—Ä–µ–¥–æ—Ö–Ω—É—Ç—å
      await new Promise(resolve => setTimeout(resolve, 10));
    }
    
    return chunks.flat();
  }
  
  async loadChunk(repoName, offset, limit) {
    const response = await fetch(`/api/repositories/${repoName}?offset=${offset}&limit=${limit}`);
    return await response.json();
  }
}
```

## üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏

```bash
#!/bin/bash
# data-maintenance.sh - –°–∫—Ä–∏–ø—Ç –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

echo "üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö DNA-utils-universal"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö..."
find ./str-matcher/public/data -name "*.json" -exec node scripts/validate-json.js {} \;

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫—ç—à–µ–π
echo "üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫—ç—à–µ–π..."
find ./cache -name "*.cache" -mtime +7 -delete

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
echo "üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤..."
node scripts/rebuild-search-index.js

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –¥–∞–Ω–Ω—ã—Ö
echo "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö:"
node scripts/data-statistics.js

echo "‚úÖ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö

```javascript
// scripts/data-quality-monitor.js
class DataQualityMonitor {
  async checkDataQuality() {
    const repositories = await loadAllRepositories();
    const report = {};
    
    for (const repo of repositories) {
      report[repo.name] = {
        totalRecords: repo.data.length,
        duplicates: this.findDuplicates(repo.data),
        missingMarkers: this.findMissingMarkers(repo.data),
        invalidHaplogroups: this.findInvalidHaplogroups(repo.data),
        qualityScore: this.calculateQualityScore(repo.data)
      };
    }
    
    return report;
  }
  
  findDuplicates(data) {
    const seen = new Set();
    const duplicates = [];
    
    data.forEach(entry => {
      if (seen.has(entry.name)) {
        duplicates.push(entry.name);
      }
      seen.add(entry.name);
    });
    
    return duplicates;
  }
  
  calculateQualityScore(data) {
    let score = 100;
    
    // –®—Ç—Ä–∞—Ñ—ã –∑–∞ –ø—Ä–æ–±–ª–µ–º—ã
    const duplicateRate = this.findDuplicates(data).length / data.length;
    score -= duplicateRate * 20;
    
    const missingMarkerRate = this.findMissingMarkers(data).length / data.length;
    score -= missingMarkerRate * 15;
    
    return Math.max(0, Math.round(score));
  }
}
```

## üîó API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### REST API –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

```javascript
// ftdna_haplo/server/routes/repositories.js
app.get('/api/repositories', async (req, res) => {
  try {
    const repositories = await dataService.getAllRepositories();
    const summary = repositories.map(repo => ({
      name: repo.name,
      description: repo.description,
      count: repo.data.length,
      lastUpdated: repo.metadata.lastUpdated,
      quality: repo.metadata.qualityScore
    }));
    
    res.json(summary);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

app.get('/api/repositories/:name', async (req, res) => {
  try {
    const { name } = req.params;
    const { offset = 0, limit = 1000, filters } = req.query;
    
    const repository = await dataService.getRepository(name);
    let data = repository.data;
    
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
    if (filters) {
      data = dataFilter.applyFilters(data, JSON.parse(filters));
    }
    
    // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
    const paginatedData = data.slice(offset, offset + limit);
    
    res.json({
      data: paginatedData,
      total: data.length,
      offset: parseInt(offset),
      limit: parseInt(limit)
    });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](../ARCHITECTURE.md)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã](configuration.md)
- [API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫](../API_REFERENCE.md)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞](../DEVELOPMENT.md)
