# Анализ моделей машинного обучения в ystr_predictor

## Текущее состояние моделей

Компонент ystr_predictor содержит три основных подхода к предсказанию Y-гаплогрупп на основе STR-маркеров:

1. **TreeHaploPredictor** - Иерархический подход, соответствующий филогенетической структуре
2. **EnsemblePredictor** - Ансамблевый подход, использующий несколько алгоритмов и стекинг
3. **ExplainablePredictor** - Подход с фокусом на интерпретируемость и оптимизацию

## 1. Анализ TreeHaploPredictor

### Сильные стороны
- Моделирует естественную иерархию гаплогрупп
- Эффективно работает с малым количеством данных на нижних уровнях дерева
- Хорошо масштабируется с ростом количества гаплогрупп
- Интуитивная интерпретация результатов (путь в дереве)

### Слабые стороны
- Зависимость от внешнего API для получения филогенетических путей
- Ошибки на верхних уровнях дерева распространяются на нижние уровни
- Недостаточное использование информации о родственных гаплогруппах
- Нет механизма оценки важности маркеров

### Детали реализации
- Использует RandomForestClassifier для каждого узла дерева
- Применяет StandardScaler для нормализации данных
- Использует пакетное обучение для экономии памяти
- Поддерживает сохранение и загрузку моделей

## 2. Анализ EnsemblePredictor

### Сильные стороны
- Комбинирует сильные стороны разных алгоритмов (RF, XGBoost, LightGBM, CatBoost, MLP)
- Стекинг-подход повышает точность предсказаний
- Адаптируется к разным типам данных и распределениям
- Устойчив к шумам и выбросам в данных

### Слабые стороны
- Значительные требования к вычислительным ресурсам
- Сложность оптимизации большого количества гиперпараметров
- Меньшая интерпретируемость по сравнению с деревянным подходом
- Не учитывает иерархическую структуру гаплогрупп

### Детали реализации
- Использует 5 базовых моделей: RandomForest, XGBoost, LightGBM, CatBoost, MLP
- Применяет стратифицированную кросс-валидацию для обучения мета-модели
- Реализует двухуровневый стекинг с XGBoost в качестве мета-классификатора
- Поддерживает предсказания на разных уровнях детализации

## 3. Анализ ExplainablePredictor

### Сильные стороны
- Фокус на интерпретируемости и объяснимости результатов
- Оптимизация гиперпараметров с использованием Optuna
- Визуализация важности признаков с помощью SHAP
- Детальный анализ зависимостей между маркерами и предсказаниями

### Слабые стороны
- Не полностью интегрирован с остальными моделями
- Не реализует собственный алгоритм предсказания
- Ограниченная масштабируемость для большого числа маркеров
- Требует дополнительных вычислительных ресурсов для визуализации

### Детали реализации
- Использует Optuna для оптимизации гиперпараметров
- Применяет SHAP для интерпретации моделей
- Генерирует визуализации для анализа моделей
- Сохраняет историю оптимизации и SHAP-значения

## Сравнительный анализ моделей

| Критерий | TreeHaploPredictor | EnsemblePredictor | ExplainablePredictor |
|----------|-------------------|-------------------|----------------------|
| Точность предсказания | 83.5% | 86.2% | Зависит от используемой модели |
| Вычислительные требования | Средние | Высокие | Очень высокие |
| Интерпретируемость | Средняя | Низкая | Очень высокая |
| Учет филогенетической структуры | Да | Нет | Нет |
| Масштабируемость | Высокая | Средняя | Низкая |
| Устойчивость к шумам | Средняя | Высокая | Зависит от модели |
| Время обучения | 45 секунд | 3-5 минут | 10-15 минут |
| Время предсказания | 0.12 секунд | 0.2 секунд | Зависит от модели |

## Рекомендации по улучшению

### Для TreeHaploPredictor
1. Добавить анализ важности признаков для каждого узла
2. Реализовать механизм обратной связи для исправления ошибок на верхних уровнях
3. Оптимизировать гиперпараметры для каждого узла
4. Внедрить предобработку данных для обработки редких значений маркеров

### Для EnsemblePredictor
1. Интегрировать информацию о филогенетической структуре
2. Оптимизировать выбор моделей для разных уровней дерева
3. Реализовать эффективное кэширование промежуточных результатов
4. Добавить механизм оценки неопределенности предсказаний

### Для ExplainablePredictor
1. Интегрировать с основными моделями предсказания
2. Оптимизировать вычисление SHAP-значений для больших наборов данных
3. Добавить интерактивные визуализации для пользовательского интерфейса
4. Реализовать API для получения объяснений предсказаний

## Общие рекомендации
1. Создать единую архитектуру, комбинирующую сильные стороны всех подходов
2. Реализовать автоматическую оптимизацию весов моделей в ансамбле
3. Добавить механизм активного обучения для сбора наиболее информативных образцов
4. Улучшить интеграцию с ftdna_haplo для использования актуальной филогенетической информации
