# Детальное описание компонентов проекта DNA-utils-universal

## 1. Компонент str-matcher

### MatchesTable.tsx
**Назначение:** Основной компонент для отображения и интерактивной работы с результатами сравнения Y-STR маркеров.

**Ключевые функции:**
- Отображение таблицы совпадений с цветовой кодировкой генетических различий
- Фильтрация результатов по множеству критериев (номер кита, имя, страна, специфичные маркеры)
- Визуализация редкости (rarity) маркеров с помощью цветового кодирования
- Интерактивная работа с гаплогруппами через всплывающее окно с детальной информацией
- Поддержка различных режимов расчета генетической дистанции

**Взаимодействие с API:**
- Получение данных о путях гаплогрупп из FTDNA и YFull
- Интеграция с внешними источниками данных о гаплогруппах

**Алгоритмы визуализации:**
- Цветовое кодирование генетической дистанции (1, 2, 3+ различия)
- Индикация редкости маркеров с пятиуровневой цветовой шкалой
- Расчёт процента совпадений между образцами

### utils/calculations.ts
**Назначение:** Содержит основные алгоритмы для расчёта генетических расстояний и сравнения STR-маркеров.

**Ключевые функции:**
- `calculateMarkerDifference` - Расчет различий между значениями STR-маркеров с учетом специальной обработки для палиндромов
- `calculateGeneticDistance` - Главный алгоритм для вычисления генетической дистанции между двумя профилями
- `calculateMarkerRarity` - Определение редкости значений маркеров в выборке
- `findMatches` - Поиск соответствий в базе данных с учетом заданных критериев
- `isHaplogroupMatch` - Проверка соответствия гаплогруппы с учетом субкладов

**Особенности реализации:**
- Поддержка стандартного и расширенного режимов расчета различий
- Специальная обработка палиндромных маркеров (составные маркеры)
- Нормализация значений маркеров перед сравнением
- Фильтрация по гаплогруппам с возможностью включения/исключения субкладов

## 2. Компонент ystr_predictor

### tree_predictor.py
**Назначение:** Реализует иерархический подход к предсказанию Y-гаплогрупп на основе Y-STR маркеров.

**Ключевые классы:**
- `HaploNode` - Узел в дереве гаплогрупп, содержащий классификационную модель
- `TreeHaploPredictor` - Основной класс для построения и использования дерева предсказаний

**Основные методы:**
- `get_haplo_path` - Получение пути гаплогруппы из внешнего API
- `train` - Обучение дерева моделей для предсказания гаплогрупп
- `predict` - Предсказание гаплогруппы путем обхода дерева
- `save_model/load_model` - Сохранение и загрузка обученной модели

**Особенности реализации:**
- Использование иерархического подхода, соответствующего филогенетическому дереву гаплогрупп
- Применение RandomForest на каждом уровне дерева для классификации
- Пакетное обучение для экономии памяти
- Интеграция с внешним API для получения филогенетических данных

### ensemble_predictor.py
**Назначение:** Реализует ансамблевый подход к предсказанию гаплогрупп с использованием нескольких алгоритмов.

**Используемые алгоритмы:**
- RandomForest
- XGBoost
- LightGBM
- CatBoost
- Нейронная сеть (MLPClassifier)

**Ключевые функции:**
- Стекинг ансамбль моделей для повышения точности предсказаний
- Кросс-валидация для обучения мета-модели
- Возможность предсказания на разных уровнях детализации гаплогрупп
- Сохранение и загрузка обученных моделей

### explainable_predictor.py
**Назначение:** Обеспечивает интерпретацию и объяснимость предсказаний моделей.

**Основные функции:**
- Оптимизация гиперпараметров моделей с использованием Optuna
- Генерация SHAP-объяснений для интерпретации предсказаний
- Визуализация важности признаков
- Построение графиков зависимостей для ключевых маркеров

## 3. Компонент ftdna_haplo

### haplo_functions.js
**Назначение:** Основные функции для работы с гаплогруппами из FTDNA.

**Ключевые функции:**
- Парсинг и нормализация гаплогрупп
- Извлечение путей в филогенетическом дереве
- Сопоставление гаплогрупп из разных систем наименования

### yfull_adapter.js
**Назначение:** Адаптер для работы с данными из YFull.

**Основные функции:**
- Интеграция с API YFull
- Преобразование данных YFull в унифицированный формат
- Синхронизация данных между FTDNA и YFull
